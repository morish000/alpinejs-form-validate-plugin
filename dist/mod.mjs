var D=(e,i,o,t)=>{let a,n=function(s){let f=t&&!a;a&&clearTimeout(a),a=setTimeout(()=>{a=null,t||i.call(e,s)},o),f&&i.call(e,s)};return n.cancel=()=>a&&clearTimeout(a),n};var w=(e,i,o,{leading:t=!0,trailing:a=!0}={})=>{let n,s=0,f=function(d){let c=Date.now();!s&&!t&&(s=c);let r=o-(c-s);r<=0?((t||s)&&(i.call(e,d),s=c),n!==null&&clearTimeout(n)):a&&(n&&clearTimeout(n),n=setTimeout(()=>{(!t||s)&&(i.call(e,d),s=t?Date.now():0)},r))};return f.cancel=()=>n&&clearTimeout(n),f};var b=(e,...i)=>{let o={...e};return i.reduce((t,a)=>(Object.entries(a).forEach(([n,s])=>{typeof s!="function"&&s instanceof Object&&n in t&&t[n]instanceof Object?t[n]=b(t[n],s):s!=null&&(t[n]=s)}),t),o)};var S=e=>{let i={};return Object.entries(e).forEach(([o,t])=>{i[o]=Array.isArray(t)?t:[t]}),i};var O=e=>{let i={};return Object.entries(e).forEach(([o,t])=>{let a=null,n=null;if(Array.isArray(t)?typeof t[0]=="function"?(a=t[0],n=Array.isArray(t[1])?t[1]:[t[1]]):n=t:typeof t=="object"&&Object.keys(t).every(s=>s==="v"||s==="m")&&("v"in t||"m"in t)?(a="v"in t?Array.isArray(t.v)||typeof t.v=="function"?t.v:[t.v]:null,n="m"in t?Array.isArray(t.m)?t.m:[t.m]:null):t!==null&&(n=[t]),!n)throw new Error(`Message undefined. validation key: ${o}`);i[o]={v:a??[],m:n}}),i};var T=e=>({report:!0,trigger:{target:e,event:"submit",preventDefault:!0,before:null,after:null}}),A=()=>({v:{},m:{},report:!1,onChange:!0,onBlur:!1,onInput:!1,inputLimit:"none",inputLimitOpts:{debounce:{wait:250,immediate:!1},throttle:{wait:500,options:{leading:!1,trailing:!0}}}});var st=e=>({isSupported:i=>typeof e[i]=="function",validate:(i,o,t,a)=>{let n=e[t];if(typeof n=="function"){let s=n(o,...a);return typeof s=="boolean"?s:!1}return!1}});var L=()=>({resolve:e=>{let i;if(e.type==="radio"){let o=e.form;if(!o)throw new Error("A form element is required.");let t=o.querySelector(`input[type="radio"][name="${e.name}"]:checked`);i=t?t.value:""}else if(e.type==="checkbox"){let o=e.form;if(!o)throw new Error("A form element is required.");let t=o.querySelectorAll(`input[type="checkbox"][name="${e.name}"]:checked`);i=Array.from(t).map(a=>a.value)}else e.type==="file"&&e instanceof HTMLInputElement?i=e.files?Array.from(e.files):[]:e.tagName.toLowerCase()==="select"&&e instanceof HTMLSelectElement?i=e.multiple?Array.from(e.selectedOptions).map(o=>o.value):e.value:i=e.value;return i},isEmpty:e=>e?typeof e=="string"?e.trim()==="":e.length===0:!0});var R=()=>{let e=["valueMissing","typeMismatch","patternMismatch","tooLong","tooShort","rangeUnderflow","rangeOverflow","stepMismatch","badInput"];return(i,o)=>{if(i.checkValidity())return null;let t=e.find(a=>i.validity[a]&&o[a]);return t?o[t]:[i.validationMessage]}};var I=(e,i)=>(o,t,{inputLimit:a,inputLimitOpts:n})=>{if(!a)return t;let[s,f]=a.split(":");switch(s){case"debounce":return e(o,t,Number(f??n.debounce.wait),n.debounce.immediate);case"throttle":return i(o,t,Number(f??n.throttle.wait),n.throttle.options);case"none":return t;default:if(s)throw new Error(`Input rate limitter not found: ${s}.`);return t}};var P=()=>({addUpdateListener:()=>{},removeUpdateListener:()=>{},resolve:(...e)=>e.length>0?e[0].toString():""});var $=e=>({messageResolver:i},o=e.reactive({}))=>(i.addUpdateListener(()=>{Object.values(o).forEach(t=>{(t.value||t.param.length>0)&&(t.value=i.resolve(...t.param),t.handleMessage(t.value))})}),{create:(t,a)=>{o[t.id]={handleMessage:a,param:[],value:""},a("")},delete:t=>{o[t.id].handleMessage(""),delete o[t.id]},set:(t,a=[])=>{let n=i.resolve(...a);o[t.id].param=a,o[t.id].value=n,o[t.id].handleMessage(n)},get:t=>o[t.id]?o[t.id].value:"",clear:t=>{o[t.id].param=[],o[t.id].value="",o[t.id].handleMessage("")}});var j=e=>(i,o,{messageStore:t,html5ValidationMessageResolver:a,fieldValueResolver:n,customFieldValidators:s})=>function(){t.clear(i);let f=i._x_validation?.formSubmit&&o.report;if(!(f?i.reportValidity():i.checkValidity())){t.set(i,a(i,o.m)??[]),i.dispatchEvent(new CustomEvent(`${e.prefixed("validate")}:failed`));return}let d=n.resolve(i);if(!i.required&&n.isEmpty(d)){t.clear(i),i.dispatchEvent(new CustomEvent(`${e.prefixed("validate")}:success`));return}for(let[c,{v:r,m:F}]of Object.entries(o.v)){if(typeof r=="function"){if(!r(i,d)){t.set(i,F),f&&i.reportValidity(),i.dispatchEvent(new CustomEvent(`${e.prefixed("validate")}:failed`));return}continue}for(let g of s)if(g.isSupported(c)&&!g.validate(i,d,c,r)){t.set(i,F),f&&i.reportValidity(),i.dispatchEvent(new CustomEvent(`${e.prefixed("validate")}:failed`));return}}i.dispatchEvent(new CustomEvent(`${e.prefixed("validate")}:success`))};var H=(e,{report:i})=>function(){return Array.from(e.elements).forEach(o=>{o._x_validation?.validate()}),i?e.reportValidity():e.checkValidity()};var U=({createMessageStore:e,createFormValidator:i,createFieldValidator:o,formDefaultConfig:t,fieldDefaultConfig:a})=>({defaultFunctionsOptions:n={},defaultFormOptions:s={},defaultFieldOptions:f={}}={})=>d=>{let c=(()=>{let r={fieldValueResolver:n.fieldValueResolver??L(),messageResolver:n.messageResolver??P(),customFieldValidators:n.customFieldValidators??[],inputRateLimitter:n.inputRateLimitter??I(D,w),html5ValidationMessageResolver:n.html5ValidationMessageResolver??R()};return{...r,messageStore:n.messageStore??e(d)(r)}})();d.directive("validate-form",(r,{expression:F},{evaluate:g,cleanup:E})=>{let m=(()=>{let y={...t(r)},C={...s},_={...F?g(F):{}},M=b(y,C,_);return M.trigger.target=_.trigger?.target??C.trigger?.target??y.trigger.target,M})(),{before:V,after:x,preventDefault:v}=m.trigger,h=i(r,m),l=y=>{V?.call(r,y);let C=h.call(r);x?.call(r,y),!C&&v&&y.preventDefault(),C?r.dispatchEvent(new CustomEvent(`${d.prefixed("validate")}:success`)):r.dispatchEvent(new CustomEvent(`${d.prefixed("validate")}:failed`))},{target:p,event:u}=m.trigger;p.addEventListener(u,l),r._x_validation=m,E(()=>{p.removeEventListener(u,l),delete r._x_validation})}),d.directive("validate",(r,{expression:F},{evaluate:g,cleanup:E})=>{if(!r.id||!r.name)throw new Error("Validation error: Form elements with validation rules must have an id and name attribute.");let m=(()=>{let l=b(a(),f,r.form?._x_validation?.report!=null?{report:r.form?._x_validation.report}:{},F?g(F):{});return l.v=O(l.v),l.m=S(l.m),l})(),V=o(d)(r,m,c),x=({before:l,after:p},u)=>y=>{l?.call(r,y),u.apply(r),p?.call(r,y)},v=[],h=(l,p,u)=>{l&&u&&v.push({eventName:p,handler:u})};h(!!m.onChange||!m.onBlur&&!m.onInput,"change",x(!m.onChange||m.onChange===!0?{}:m.onChange,V)),h(!!m.onBlur,"blur",x(!m.onBlur||m.onBlur===!0?{}:m.onBlur,V)),h(!!m.onInput,"input",c.inputRateLimitter(r,x(!m.onInput||m.onInput===!0?{}:m.onInput,V),m)),r._x_validation={...m,formSubmit:!r.form,validate:function(){V(),this.formSubmit=!0,["radio","checkbox"].includes(r.type)&&Array.from(r.form?.querySelectorAll(`input[type="${r.type}"][name="${r.name}"]`)??[]).filter(l=>l!==r&&!l.hasAttribute(d.prefixed("validate"))).forEach(l=>{v.forEach(({eventName:p,handler:u})=>{l.addEventListener(p,u)})})}},c.messageStore.create(r,l=>{r.setCustomValidity(l),r._x_validation?.formSubmit&&l&&m.report&&r.reportValidity()}),v.forEach(({eventName:l,handler:p})=>{r.addEventListener(l,p)}),E(()=>{["radio","checkbox"].includes(r.type)&&Array.from(r.form?.querySelectorAll(`input[type="${r.type}"][name="${r.name}"]`)??[]).filter(l=>l!==r&&!l.hasAttribute(d.prefixed("validate"))).forEach(l=>{v.forEach(({eventName:p,handler:u})=>{l.removeEventListener(p,u)})}),v.forEach(({eventName:l,handler:p})=>{r.removeEventListener(l,p),p.cancel?.()}),c.messageStore.delete(r),delete r._x_validation})}),d.directive("validate-message-for",(r,{expression:F},{effect:g})=>{g(()=>{let E=document.querySelector(F);d.mutateDom(()=>{r.textContent=E?c.messageStore.get(E):""})})})},q=U({createMessageStore:$,createFormValidator:H,createFieldValidator:j,formDefaultConfig:T,fieldDefaultConfig:A}),Ot=q();var At=e=>i=>{let o=e.i18next(),t=()=>e.timestamp=Date.now();["languageChanged","loaded"].forEach(a=>o.on(a,t)),["added","removed"].forEach(a=>o.store.on(a,t)),i.magic("t",()=>(a,n)=>(e.timestamp,o.t(a,n))),i.magic("i18next",()=>()=>o),i.directive("i18next-text",(a,{expression:n},{evaluateLater:s,effect:f})=>{let d=s(n);f(()=>{e.timestamp,d(([c,r])=>{i.mutateDom(()=>{a.textContent=o.t(c,r)})})})})};export{st as createCustomFieldValidator,j as createFieldValidator,L as createFieldValueResolver,H as createFormValidator,R as createHtml5ValidationMessageResolver,At as createI18NextPlugin,I as createInputRateLimitter,P as createMessageResolver,$ as createMessageStore,q as createValidatePlugin,Ot as createValidatePluginDefault,U as createValidatePluginInternal,D as debounce,A as fieldDefaultConfig,T as formDefaultConfig,S as formatMessageConfig,O as formatValidationConfig,b as merge,w as throttle};
//# sourceMappingURL=mod.mjs.map

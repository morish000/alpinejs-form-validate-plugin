var D=(t,i,o,e)=>{let a,r=function(s){let f=e&&!a;a&&clearTimeout(a),a=setTimeout(()=>{a=null,e||i.call(t,s)},o),f&&i.call(t,s)};return r.cancel=()=>a&&clearTimeout(a),r};var w=(t,i,o,{leading:e=!0,trailing:a=!0}={})=>{let r,s=0,f=function(d){let p=Date.now();!s&&!e&&(s=p);let n=o-(p-s);n<=0?((e||s)&&(i.call(t,d),s=p),r!==null&&clearTimeout(r)):a&&(r&&clearTimeout(r),r=setTimeout(()=>{(!e||s)&&(i.call(t,d),s=e?Date.now():0)},n))};return f.cancel=()=>r&&clearTimeout(r),f};var b=(t,...i)=>{let o={...t};return i.reduce((e,a)=>(Object.entries(a).forEach(([r,s])=>{typeof s!="function"&&s instanceof Object&&r in e&&e[r]instanceof Object?e[r]=b(e[r],s):s!=null&&(e[r]=s)}),e),o)};var O=t=>{let i={};return Object.entries(t).forEach(([o,e])=>{i[o]=Array.isArray(e)?e:[e]}),i};var T=t=>{let i={};return Object.entries(t).forEach(([o,e])=>{let a=null,r=null;if(Array.isArray(e)?typeof e[0]=="function"?(a=e[0],r=Array.isArray(e[1])?e[1]:[e[1]]):r=e:typeof e=="object"&&Object.keys(e).every(s=>s==="v"||s==="m")&&("v"in e||"m"in e)?(a="v"in e?Array.isArray(e.v)||typeof e.v=="function"?e.v:[e.v]:null,r="m"in e?Array.isArray(e.m)?e.m:[e.m]:null):e!==null&&(r=[e]),!r)throw new Error(`Message undefined. validation key: ${o}`);i[o]={v:a??[],m:r}}),i};var S=t=>({report:!0,trigger:{target:t,event:"submit",preventDefault:!0,before:null,after:null}}),A=()=>({v:{},m:{},onChange:!0,onBlur:!1,onInput:!1,inputLimit:"none",inputLimitOpts:{debounce:{wait:250,immediate:!1},throttle:{wait:500,options:{leading:!1,trailing:!0}}}});var se=t=>({isSupported:i=>typeof t[i]=="function",validate:(i,o,e,a)=>{let r=t[e];if(typeof r=="function"){let s=r(o,...a);return typeof s=="boolean"?s:!1}return!1}});var L=()=>({resolve:t=>{let i;if(t.type==="radio"){let o=t.form;if(!o)throw new Error("A form element is required.");let e=o.querySelector(`input[type="radio"][name="${t.name}"]:checked`);i=e?e.value:""}else if(t.type==="checkbox"){let o=t.form;if(!o)throw new Error("A form element is required.");let e=o.querySelectorAll(`input[type="checkbox"][name="${t.name}"]:checked`);i=Array.from(e).map(a=>a.value)}else t.type==="file"&&t instanceof HTMLInputElement?i=t.files?Array.from(t.files):[]:t.tagName.toLowerCase()==="select"&&t instanceof HTMLSelectElement?i=t.multiple?Array.from(t.selectedOptions).map(o=>o.value):t.value:i=t.value;return i},isEmpty:t=>t?typeof t=="string"?t.trim()==="":t.length===0:!0});var R=()=>{let t=["valueMissing","typeMismatch","patternMismatch","tooLong","tooShort","rangeUnderflow","rangeOverflow","stepMismatch","badInput"];return(i,o)=>{if(i.checkValidity())return null;let e=t.find(a=>i.validity[a]&&o[a]);return e?o[e]:[i.validationMessage]}};var I=(t,i)=>(o,e,{inputLimit:a,inputLimitOpts:r})=>{if(!a)return e;let[s,f]=a.split(":");switch(s){case"debounce":return t(o,e,Number(f??r.debounce.wait),r.debounce.immediate);case"throttle":return i(o,e,Number(f??r.throttle.wait),r.throttle.options);case"none":return e;default:if(s)throw new Error(`Input rate limitter not found: ${s}.`);return e}};var P=()=>({addUpdateListener:()=>{},removeUpdateListener:()=>{},resolve:(...t)=>t.length>0?t[0].toString():""});var $=t=>({messageResolver:i},o=t.reactive({}))=>(i.addUpdateListener(()=>{Object.values(o).forEach(e=>{(e.value||e.param.length>0)&&(e.value=i.resolve(...e.param),e.handleMessage(e.value))})}),{create:(e,a)=>{o[e.id]={handleMessage:a,param:[],value:""},a("")},delete:e=>{o[e.id].handleMessage(""),delete o[e.id]},set:(e,a=[])=>{let r=i.resolve(...a);o[e.id].param=a,o[e.id].value=r,o[e.id].handleMessage(r)},get:e=>o[e.id]?o[e.id].value:"",clear:e=>{o[e.id].param=[],o[e.id].value="",o[e.id].handleMessage("")}});var j=t=>(i,o,{messageStore:e,html5ValidationMessageResolver:a,fieldValueResolver:r,customFieldValidators:s})=>function(){if(e.clear(i),!i.checkValidity()){e.set(i,a(i,o.m)??[]),i.dispatchEvent(new CustomEvent(`${t.prefixed("validate")}:failed`));return}let f=r.resolve(i);if(!i.required&&r.isEmpty(f)){e.clear(i),i.dispatchEvent(new CustomEvent(`${t.prefixed("validate")}:success`));return}for(let[d,{v:p,m:n}]of Object.entries(o.v)){if(typeof p=="function"){if(!p(i,f)){e.set(i,n),i.dispatchEvent(new CustomEvent(`${t.prefixed("validate")}:failed`));return}continue}for(let F of s)if(F.isSupported(d)&&!F.validate(i,f,d,p)){e.set(i,n),i.dispatchEvent(new CustomEvent(`${t.prefixed("validate")}:failed`));return}}i.dispatchEvent(new CustomEvent(`${t.prefixed("validate")}:success`))};var H=(t,{report:i})=>function(){return Array.from(t.elements).forEach(o=>{o._x_validation?.validate()}),i?t.reportValidity():t.checkValidity()};var U=({createMessageStore:t,createFormValidator:i,createFieldValidator:o,formDefaultConfig:e,fieldDefaultConfig:a})=>({defaultFunctionsOptions:r={},defaultFormOptions:s={},defaultFieldOptions:f={}}={})=>d=>{let p=(()=>{let n={fieldValueResolver:r.fieldValueResolver??L(),messageResolver:r.messageResolver??P(),customFieldValidators:r.customFieldValidators??[],inputRateLimitter:r.inputRateLimitter??I(D,w),html5ValidationMessageResolver:r.html5ValidationMessageResolver??R()};return{...n,messageStore:r.messageStore??t(d)(n)}})();d.directive("validate-form",(n,{expression:F},{evaluate:V,cleanup:v})=>{let m=(()=>{let g={...e(n)},C={...s},M={...F?V(F):{}},_=b(g,C,M);return _.trigger.target=M.trigger?.target??C.trigger?.target??g.trigger.target,_})(),{before:E,after:h,preventDefault:y}=m.trigger,x=i(n,m),l=g=>{E?.call(n,g);let C=x.call(n);h?.call(n,g),!C&&y&&g.preventDefault(),C?n.dispatchEvent(new CustomEvent(`${d.prefixed("validate")}:success`)):n.dispatchEvent(new CustomEvent(`${d.prefixed("validate")}:failed`))},{target:c,event:u}=m.trigger;c.addEventListener(u,l),n._x_validation=m,v(()=>{c.removeEventListener(u,l),delete n._x_validation})}),d.directive("validate",(n,{expression:F},{evaluate:V,cleanup:v})=>{if(!n.id||!n.name)throw new Error("Validation error: Form elements with validation rules must have an id and name attribute.");let m=(()=>{let l=b(a(),f,F?V(F):{});return l.v=T(l.v),l.m=O(l.m),l})(),E=o(d)(n,m,p),h=({before:l,after:c},u)=>g=>{l?.call(n,g),u.apply(n),c?.call(n,g)},y=[],x=(l,c,u)=>{l&&u&&y.push({eventName:c,handler:u})};x(!!m.onChange||!m.onBlur&&!m.onInput,"change",h(!m.onChange||m.onChange===!0?{}:m.onChange,E)),x(!!m.onBlur,"blur",h(!m.onBlur||m.onBlur===!0?{}:m.onBlur,E)),x(!!m.onInput,"input",p.inputRateLimitter(n,h(!m.onInput||m.onInput===!0?{}:m.onInput,E),m)),n._x_validation={...m,formSubmit:!n.form,validate:function(){E(),this.formSubmit=!0,["radio","checkbox"].includes(n.type)&&Array.from(n.form?.querySelectorAll(`input[type="${n.type}"][name="${n.name}"]`)??[]).filter(l=>l!==n&&!l.hasAttribute(d.prefixed("validate"))).forEach(l=>{y.forEach(({eventName:c,handler:u})=>{l.addEventListener(c,u)})})}},p.messageStore.create(n,l=>{n.setCustomValidity(l)}),y.forEach(({eventName:l,handler:c})=>{n.addEventListener(l,c)}),v(()=>{["radio","checkbox"].includes(n.type)&&Array.from(n.form?.querySelectorAll(`input[type="${n.type}"][name="${n.name}"]`)??[]).filter(l=>l!==n&&!l.hasAttribute(d.prefixed("validate"))).forEach(l=>{y.forEach(({eventName:c,handler:u})=>{l.removeEventListener(c,u)})}),y.forEach(({eventName:l,handler:c})=>{n.removeEventListener(l,c),c.cancel?.()}),p.messageStore.delete(n),delete n._x_validation})}),d.directive("validate-message-for",(n,{expression:F},{effect:V})=>{V(()=>{let v=document.querySelector(F);d.mutateDom(()=>{n.textContent=v?p.messageStore.get(v):""})})})},q=U({createMessageStore:$,createFormValidator:H,createFieldValidator:j,formDefaultConfig:S,fieldDefaultConfig:A}),Te=q();var Ae=t=>i=>{let o=t.i18next(),e=()=>t.timestamp=Date.now();["languageChanged","loaded"].forEach(a=>o.on(a,e)),["added","removed"].forEach(a=>o.store.on(a,e)),i.magic("t",()=>(a,r)=>(t.timestamp,o.t(a,r))),i.magic("i18next",()=>()=>o),i.directive("i18next-text",(a,{expression:r},{evaluateLater:s,effect:f})=>{let d=s(r);f(()=>{t.timestamp,d(([p,n])=>{i.mutateDom(()=>{a.textContent=o.t(p,n)})})})})};export{se as createCustomFieldValidator,j as createFieldValidator,L as createFieldValueResolver,H as createFormValidator,R as createHtml5ValidationMessageResolver,Ae as createI18NextPlugin,I as createInputRateLimitter,P as createMessageResolver,$ as createMessageStore,q as createValidatePlugin,Te as createValidatePluginDefault,U as createValidatePluginInternal,D as debounce,A as fieldDefaultConfig,S as formDefaultConfig,O as formatMessageConfig,T as formatValidationConfig,b as merge,w as throttle};
//# sourceMappingURL=mod.mjs.map

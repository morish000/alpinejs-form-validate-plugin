var D=(t,i,o,e)=>{let a,n=function(s){let f=e&&!a;a&&clearTimeout(a),a=setTimeout(()=>{a=null,e||i.call(t,s)},o),f&&i.call(t,s)};return n.cancel=()=>a&&clearTimeout(a),n};var w=(t,i,o,{leading:e=!0,trailing:a=!0}={})=>{let n,s=0,f=function(d){let p=Date.now();!s&&!e&&(s=p);let r=o-(p-s);r<=0?((e||s)&&(i.call(t,d),s=p),n!==null&&clearTimeout(n)):a&&(n&&clearTimeout(n),n=setTimeout(()=>{(!e||s)&&(i.call(t,d),s=e?Date.now():0)},r))};return f.cancel=()=>n&&clearTimeout(n),f};var b=(t,...i)=>{let o={...t};return i.reduce((e,a)=>(Object.entries(a).forEach(([n,s])=>{typeof s!="function"&&s instanceof Object&&n in e&&e[n]instanceof Object?e[n]=b(e[n],s):s!=null&&(e[n]=s)}),e),o)};var T=t=>{let i={};return Object.entries(t).forEach(([o,e])=>{i[o]=Array.isArray(e)?e:[e]}),i};var O=t=>{let i={};return Object.entries(t).forEach(([o,e])=>{let a=null,n=null;if(Array.isArray(e)?typeof e[0]=="function"?(a=e[0],n=Array.isArray(e[1])?e[1]:[e[1]]):n=e:typeof e=="object"&&Object.keys(e).every(s=>s==="v"||s==="m")&&("v"in e||"m"in e)?(a="v"in e?Array.isArray(e.v)||typeof e.v=="function"?e.v:[e.v]:null,n="m"in e?Array.isArray(e.m)?e.m:[e.m]:null):e!==null&&(n=[e]),!n)throw new Error(`Message undefined. validation key: ${o}`);i[o]={v:a??[],m:n}}),i};var S=t=>({report:!0,trigger:{target:t,event:"submit",preventDefault:!0,before:null,after:null}}),A=()=>({v:{},m:{},report:!1,onChange:!0,onBlur:!1,onInput:!1,inputLimit:"none",inputLimitOpts:{debounce:{wait:250,immediate:!1},throttle:{wait:500,options:{leading:!1,trailing:!0}}}});var se=t=>({isSupported:i=>typeof t[i]=="function",validate:(i,o,e,a)=>{let n=t[e];if(typeof n=="function"){let s=n(o,...a);return typeof s=="boolean"?s:!1}return!1}});var L=()=>({resolve:t=>{let i;if(t.type==="radio"){let o=t.form;if(!o)throw new Error("A form element is required.");let e=o.querySelector(`input[type="radio"][name="${t.name}"]:checked`);i=e?e.value:""}else if(t.type==="checkbox"){let o=t.form;if(!o)throw new Error("A form element is required.");let e=o.querySelectorAll(`input[type="checkbox"][name="${t.name}"]:checked`);i=Array.from(e).map(a=>a.value)}else t.type==="file"&&t instanceof HTMLInputElement?i=t.files?Array.from(t.files):[]:t.tagName.toLowerCase()==="select"&&t instanceof HTMLSelectElement?i=t.multiple?Array.from(t.selectedOptions).map(o=>o.value):t.value:i=t.value;return i},isEmpty:t=>t?typeof t=="string"?t.trim()==="":t.length===0:!0});var R=()=>{let t=["valueMissing","typeMismatch","patternMismatch","tooLong","tooShort","rangeUnderflow","rangeOverflow","stepMismatch","badInput"];return(i,o)=>{if(i.checkValidity())return null;let e=t.find(a=>i.validity[a]&&o[a]);return e?o[e]:[i.validationMessage]}};var I=(t,i)=>(o,e,{inputLimit:a,inputLimitOpts:n})=>{if(!a)return e;let[s,f]=a.split(":");switch(s){case"debounce":return t(o,e,Number(f??n.debounce.wait),n.debounce.immediate);case"throttle":return i(o,e,Number(f??n.throttle.wait),n.throttle.options);case"none":return e;default:if(s)throw new Error(`Input rate limitter not found: ${s}.`);return e}};var P=()=>({addUpdateListener:()=>{},removeUpdateListener:()=>{},resolve:(...t)=>t.length>0?t[0].toString():""});var $=t=>({messageResolver:i},o=t.reactive({}))=>(i.addUpdateListener(()=>{Object.values(o).forEach(e=>{(e.value||e.param.length>0)&&(e.value=i.resolve(...e.param),e.handleMessage(e.value))})}),{create:(e,a)=>{o[e.id]={handleMessage:a,param:[],value:""},a("")},delete:e=>{o[e.id].handleMessage(""),delete o[e.id]},set:(e,a)=>{let n=i.resolve(...a);o[e.id].param=a,o[e.id].value=n,o[e.id].handleMessage(n)},get:e=>o[e.id]?o[e.id].value:"",clear:e=>{o[e.id].param=[],o[e.id].value="",o[e.id].handleMessage("")}});var j=t=>(i,o,{messageStore:e,html5ValidationMessageResolver:a,fieldValueResolver:n,customFieldValidators:s})=>function(){if(e.clear(i),!i.checkValidity()){e.set(i,a(i,o.m)??[]),i.dispatchEvent(new CustomEvent(`${t.prefixed("validate")}:failed`));return}let f=n.resolve(i);if(!i.required&&n.isEmpty(f)){e.clear(i),i.dispatchEvent(new CustomEvent(`${t.prefixed("validate")}:success`));return}for(let[d,{v:p,m:r}]of Object.entries(o.v)){if(typeof p=="function"){if(!p(i,f)){e.set(i,r),i.dispatchEvent(new CustomEvent(`${t.prefixed("validate")}:failed`));return}continue}for(let F of s)if(F.isSupported(d)&&!F.validate(i,f,d,p)){e.set(i,r),i.dispatchEvent(new CustomEvent(`${t.prefixed("validate")}:failed`));return}}i.dispatchEvent(new CustomEvent(`${t.prefixed("validate")}:success`))};var H=(t,{report:i})=>function(){return Array.from(t.elements).forEach(o=>{o._x_validation?.validate()}),i?t.reportValidity():t.checkValidity()};var U=({createMessageStore:t,createFormValidator:i,createFieldValidator:o,formDefaultConfig:e,fieldDefaultConfig:a})=>({defaultFunctionsOptions:n={},defaultFormOptions:s={},defaultFieldOptions:f={}}={})=>d=>{let p=(()=>{let r={fieldValueResolver:n.fieldValueResolver??L(),messageResolver:n.messageResolver??P(),customFieldValidators:n.customFieldValidators??[],inputRateLimitter:n.inputRateLimitter??I(D,w),html5ValidationMessageResolver:n.html5ValidationMessageResolver??R()};return{...r,messageStore:n.messageStore??t(d)(r)}})();d.directive("validate-form",(r,{expression:F},{evaluate:V,cleanup:v})=>{let m=(()=>{let y={...e(r)},C={...s},_={...F?V(F):{}},M=b(y,C,_);return M.trigger.target=_.trigger?.target??C.trigger?.target??y.trigger.target,M})(),{before:E,after:x,preventDefault:g}=m.trigger,h=i(r,m),l=y=>{E?.call(r,y);let C=h.call(r);x?.call(r,y),!C&&g&&y.preventDefault(),C?r.dispatchEvent(new CustomEvent(`${d.prefixed("validate")}:success`)):r.dispatchEvent(new CustomEvent(`${d.prefixed("validate")}:failed`))},{target:c,event:u}=m.trigger;c.addEventListener(u,l),r._x_validation=m,v(()=>{c.removeEventListener(u,l),delete r._x_validation})}),d.directive("validate",(r,{expression:F},{evaluate:V,cleanup:v})=>{if(!r.id||!r.name)throw new Error("Validation error: Form elements with validation rules must have an id and name attribute.");let m=(()=>{let l=b(a(),f,r.form?._x_validation?.report!=null?{report:r.form?._x_validation.report}:{},F?V(F):{});return l.v=O(l.v),l.m=T(l.m),l})(),E=o(d)(r,m,p),x=({before:l,after:c},u)=>y=>{l?.call(r,y),u.apply(r),r._x_validation?.formSubmit&&m.report&&r.reportValidity(),c?.call(r,y)},g=[],h=(l,c,u)=>{l&&u&&g.push({eventName:c,handler:u})};h(!!m.onChange||!m.onBlur&&!m.onInput,"change",x(!m.onChange||m.onChange===!0?{}:m.onChange,E)),h(!!m.onBlur,"blur",x(!m.onBlur||m.onBlur===!0?{}:m.onBlur,E)),h(!!m.onInput,"input",p.inputRateLimitter(r,x(!m.onInput||m.onInput===!0?{}:m.onInput,E),m)),r._x_validation={...m,formSubmit:!r.form,validate:function(){E(),this.formSubmit=!0,["radio","checkbox"].includes(r.type)&&Array.from(r.form?.querySelectorAll(`input[type="${r.type}"][name="${r.name}"]`)??[]).filter(l=>l!==r&&!l.hasAttribute(d.prefixed("validate"))).forEach(l=>{g.forEach(({eventName:c,handler:u})=>{l.addEventListener(c,u)})})}},p.messageStore.create(r,l=>{r.setCustomValidity(l)}),g.forEach(({eventName:l,handler:c})=>{r.addEventListener(l,c)}),v(()=>{["radio","checkbox"].includes(r.type)&&Array.from(r.form?.querySelectorAll(`input[type="${r.type}"][name="${r.name}"]`)??[]).filter(l=>l!==r&&!l.hasAttribute(d.prefixed("validate"))).forEach(l=>{g.forEach(({eventName:c,handler:u})=>{l.removeEventListener(c,u)})}),g.forEach(({eventName:l,handler:c})=>{r.removeEventListener(l,c),c.cancel?.()}),p.messageStore.delete(r),delete r._x_validation})}),d.directive("validate-message-for",(r,{expression:F},{effect:V})=>{V(()=>{let v=document.querySelector(F);d.mutateDom(()=>{r.textContent=v?p.messageStore.get(v):""})})})},q=U({createMessageStore:$,createFormValidator:H,createFieldValidator:j,formDefaultConfig:S,fieldDefaultConfig:A}),Oe=q();var Ae=t=>i=>{let o=t.i18next(),e=()=>t.timestamp=Date.now();["languageChanged","loaded"].forEach(a=>o.on(a,e)),["added","removed"].forEach(a=>o.store.on(a,e)),i.magic("t",()=>(a,n)=>(t.timestamp,o.t(a,n))),i.magic("i18next",()=>()=>o),i.directive("i18next-text",(a,{expression:n},{evaluateLater:s,effect:f})=>{let d=s(n);f(()=>{t.timestamp,d(([p,r])=>{i.mutateDom(()=>{a.textContent=o.t(p,r)})})})})};export{se as createCustomFieldValidator,j as createFieldValidator,L as createFieldValueResolver,H as createFormValidator,R as createHtml5ValidationMessageResolver,Ae as createI18NextPlugin,I as createInputRateLimitter,P as createMessageResolver,$ as createMessageStore,q as createValidatePlugin,Oe as createValidatePluginDefault,U as createValidatePluginInternal,D as debounce,A as fieldDefaultConfig,S as formDefaultConfig,T as formatMessageConfig,O as formatValidationConfig,b as merge,w as throttle};
//# sourceMappingURL=mod.mjs.map
